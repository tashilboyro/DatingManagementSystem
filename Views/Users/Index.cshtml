@model IEnumerable<DatingManagementSystem.Models.User>

@{
	ViewData["Title"] = "Users List";
}
@{
	var userName = Context.Session.GetString("UserName");
	var userEmail = Context.Session.GetString("UserEmail");
	var userID = Context.Session.GetString("UserID");
}

<style>
	body {
		background: #f3e8ff; /* Pale Purple */
		margin: 0;
	}

	.swiper-container {
		padding: 0px 0; /* reduced padding to bring cards closer vertically */
	}

	.swiper-slide {
		display: flex;
		justify-content: center;
		margin: 0; /* remove any margin that could push slides apart */
	}

	.card.profile-card {
		width: 300px;
		height: 480px;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		border: none;
		background-color: white;
		border-radius: 20px;
		transition: transform 0.3s ease, box-shadow 0.3s ease;
		box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.03);
	}

		.card.profile-card:hover {
			transform: translateY(-5px) scale(1.02);
			box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25), 0 8px 10px rgba(0, 0, 0, 0.2);
		}

	.card img {
		transition: transform 0.3s ease;
	}

		.card img:hover {
			transform: scale(1.05);
		}
</style>



<!-- Swiper Container -->
<!-- Swiper Container -->
<div class="swiper-container">
	<div class="swiper-wrapper">
		@foreach (var user in Model)
		{
			<div class="swiper-slide">
				<div class="card profile-card text-center p-4">
					@{
						string base64Image = user.ProfilePicture != null
						? $"data:image/png;base64,{Convert.ToBase64String(user.ProfilePicture)}"
						: "/images/default-avatar.png";
					}

					<!-- Profile Picture -->
					<div class="d-flex justify-content-center align-items-center" style="flex-grow: 1;">
						<img src="@base64Image" class="rounded-circle border border-2 border-secondary"
							 alt="@user.FirstName"
							 style="width: 200px; height: 200px; object-fit: cover;">
					</div>

					<!-- Info -->
					<div>
						<h5 class="mt-3 mb-1">@user.FirstName, @user.Age</h5>
						<p class="text-muted px-2">@user.Bio</p>
					</div>

					<!-- Buttons -->
					<div class="mt-3 mb-2 d-flex justify-content-around">
						<button class="btn btn-success rounded-pill px-3">Like ❤</button>
						<button class="btn btn-danger rounded-pill px-3">Skip ❌</button>
					</div>
				</div>
			</div>
		}
	</div>

	<!-- Swiper Navigation -->
	<div class="swiper-pagination"></div>
	<div class="swiper-button-next"></div>
	<div class="swiper-button-prev"></div>
</div>



<!-- Swiper.js CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

<script>

		var swiper = new Swiper('.swiper-container', {
		slidesPerView: 1,
		spaceBetween: 0, // Remove horizontal spacing
		loop: true,
		navigation: {
			nextEl: '.swiper-button-next',
			prevEl: '.swiper-button-prev',
		},
		pagination: {
			el: '.swiper-pagination',
			clickable: true,
		},
	});

	sessionStorage.setItem("UserName", "@userName");
	sessionStorage.setItem("UserEmail", "@userEmail");
	sessionStorage.setItem("UserID", "@userID");

	console.log("User Name:", sessionStorage.getItem("UserName"));
	console.log("User Email:", sessionStorage.getItem("UserEmail"));
	console.log("User ID:", sessionStorage.getItem("UserID"));

	document.addEventListener("DOMContentLoaded", function () {
		console.log("DOM fully loaded and parsed, calling fetchCompatibilityScores");
		fetchCompatibilityScores();
	});

	async function fetchCompatibilityScores() {
		const carouselInner = document.getElementById("userCarouselInner");

		if (!carouselInner) {
			console.error("Error: 'userCarouselInner' element not found in the DOM.");
			return;
		}

		const userId = sessionStorage.getItem("UserID");

		try {
			const response = await fetch(`/Users/GetSortedCompatibilityScoresForLoggedInUser`);
			const result = await response.json();

			console.log("Message:", result.message);
			console.log("Fetched sorted scores:", result.results);

			carouselInner.innerHTML = "";

			result.results.forEach((item, index) => {
				const user = item.user;
				if (user) {
					const slide = document.createElement("div");
					slide.classList.add("carousel-item");
					if (index === 0) slide.classList.add("active");

					slide.innerHTML = `
						<div class="d-flex justify-content-center">
							<div class="card text-center shadow" style="width: 22rem;">
								<img src="${user.profilePictureUrl}" class="card-img-top rounded-circle m-3 border border-3 border-secondary" style="width: 150px; height: 150px; object-fit: cover;" alt="${user.firstName}'s profile picture">
								<div class="card-body">
									<h5 class="card-title">${user.firstName} ${user.lastName} (${user.age}, ${user.gender})</h5>
									<p class="card-text"><strong>Email:</strong> ${user.email}</p>
									<p class="card-text"><strong>Interests:</strong> ${user.interests}</p>
									<p class="card-text"><strong>Bio:</strong> ${user.bio}</p>
									<p class="card-text text-muted"><small>Joined on ${new Date(user.createdAt).toLocaleDateString()}</small></p>
									<div class="d-flex justify-content-center gap-2">
										<button class="btn btn-primary btn-sm">View</button>
										
									</div>
								</div>
							</div>
						</div>
					`;

					carouselInner.appendChild(slide);
				}
			});
		} catch (error) {
			console.error("Error fetching compatibility scores or user details:", error);
		}
	}
</script>
