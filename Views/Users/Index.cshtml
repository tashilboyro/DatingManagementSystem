@model IEnumerable<DatingManagementSystem.Models.User>

@{
	ViewData["Title"] = "Users List";
}

@{
	var userName = Context.Session.GetString("UserName");
	var userEmail = Context.Session.GetString("UserEmail");
	var userID = Context.Session.GetString("UserID");
}

<!-- Swiper Container -->
<div class="swiper-container">
	<div class="swiper-wrapper">
	</div>

	<!-- Swiper Navigation -->
	<div class="swiper-pagination"></div>
	<div class="swiper-button-next"></div>
	<div class="swiper-button-prev"></div>
</div>

<!-- Swiper.js CDN -->
<link rel="stylesheet" href="/css/index.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

<script>
	// Store user details in Session Storage
	sessionStorage.setItem("UserName", "@userName");
	sessionStorage.setItem("UserEmail", "@userEmail");
	sessionStorage.setItem("UserID", "@userID");

	// Retrieve and log session storage data
	console.log("User Name:", sessionStorage.getItem("UserName"));
	console.log("User Email:", sessionStorage.getItem("UserEmail"));
	console.log("User ID:", sessionStorage.getItem("UserID"));

	document.addEventListener("DOMContentLoaded", function () {
		console.log("DOM fully loaded and parsed, calling fetchCompatibilityScores");
		fetchCompatibilityScores();
	});

	async function fetchCompatibilityScores() {
		const swiperWrapper = document.querySelector(".swiper-wrapper");

		if (!swiperWrapper) {
			console.error("Error: 'swiper-wrapper' element not found in the DOM.");
			return;
		}

		const userId = sessionStorage.getItem("UserID");

		try {
			const response = await fetch(`/Users/GetSortedCompatibilityScoresForLoggedInUser`);
			const result = await response.json();

			console.log("Fetched sorted scores:", result.results);

			swiperWrapper.innerHTML = ""; // Clear existing slides

			for (let item of result.results) {
				const user = item.user;

				if (user) {
					const base64Image = user.profilePictureUrl
						? user.profilePictureUrl // If the profile picture is available
						: "/images/default-avatar.png"; // Fallback image

					const slide = document.createElement("div");
					slide.classList.add("swiper-slide");

					slide.innerHTML = `
						<div class="card profile-card text-center p-4">
							<div class="d-flex justify-content-center align-items-center" style="flex-grow: 1;">
								<img src="${base64Image}" class="rounded-circle border border-2 border-secondary" alt="${user.firstName}" style="width: 150px; height: 150px; object-fit: cover;">
							</div>
							<h5 class="mt-3 mb-1">${user.firstName}, ${user.age}</h5>
							<p class="text-muted px-2">${user.bio}</p>
							<div class="mt-3 mb-2 d-flex justify-content-around">
								<button class="btn btn-success rounded-pill px-3">Like ❤</button>
								<button class="btn btn-danger rounded-pill px-3">Skip ❌</button>
							</div>
						</div>
					`;

					swiperWrapper.appendChild(slide);
				} else {
					console.log("User data not found for UserId:", userId);
				}
			}

			// Initialize Swiper after the content is loaded
	var swiper = new Swiper('.swiper-container', {
		slidesPerView: 3,
		spaceBetween: 100, // Add spacing between cards
		loop: false, // Prevents extra slides from showing
		navigation: {
			nextEl: '.swiper-button-next',
			prevEl: '.swiper-button-prev',
		},
		pagination: {
			el: '.swiper-pagination',
			clickable: true,
		},
	});

		} catch (error) {
			console.error("Error fetching compatibility scores or user details:", error);
		}
	}
</script>